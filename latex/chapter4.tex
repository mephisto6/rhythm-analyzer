%----------------------------------------------------------------------------
\chapter{A megvalósítás}
%----------------------------------------------------------------------------

Az elõzõ fejezetkben definiáltam egy problémát számos megoldási lehetõséggel. A feladatom az volt, hogy hozzak létre egy szoftvert, amely erre a problémára választ ad. Ehhez implementálni kellett a kották beolvasását, a ritmus kinyerését, a távolságok meghatározását, a klaszterezés futtatását és az eredmények megjelenítését. 

A szoftver elékészítéséhez a Java nyelvet választottam annak platformfüggetlensége, széleskörû elterjedtsége, támogatottsága és rendelkezésre álló funkcionalitásának sokszínûsége miatt.

%----------------------------------------------------------------------------
\section{Forrásfájlok feldolgozása}
%----------------------------------------------------------------------------

A vizsgálandó dalok nem hangfájlként állnak rendelkezésre, hanem speciálisan kódolt kották formájában. Ezek sorai megfelelnek egy hagyományos kotta sorainak, a sorok elemei pedig tartalmazzák az egymás után következõ hangok magasságát és idõtartamát.


\begin{lstlisting}[frame=single,captionpos=b,caption={Egy kódolt kotta},label={list:kotta}]
T1/2 K2b [8G2 8G2 8G2 8G2] |K2b [8H2 8H2 8A2 8G2] |K2b 8A2 4F2. |
     K2b [8G2 8G2 8A2 8G2] |K2b [8F2 8E2 8D2 8C2] |K2b 8D2 4H1. |
     K2b 4D2 [8D2 8C2] |K2b [8H1 8H1 8C2 8H1] |K2b 8A1 4G1. |
     K2b [8H1 8H1 8A1 8G1] |K2b [#8F1 8G1 8A1 8H1] |K2b 4G1 R4 |

\end{lstlisting}

A \ref{list:kotta}-es fájlban egy ilyen speciálisan kódolt kottát láthatunk. Az elsõ eleme a fájlnak az ütemek hosszát határozza meg. Az ütemek között (az igazi kottához hasonlóan) függõleges vonat ($|$) található, a kottában is szereplõ gerendákat $[$ és $]$ jelöli, de ezek számunkra nem hordoznak hasznos információt. 

Az ütem elsõ eleme a hangmagasságra vonatkozik, ezért a ritmus vizsgálatakor figyelmen kívül hagyhatjuk. Utána jönnek a hangok, melynek elsõ része határozza meg a hang hosszát, második a magasságát. A \ref{list:kotta}-es fájl elsõ hangot reprezentáló eleme a $8G2$, mely egy $1/8$ hosszúságú $G$ hangot jelöl a második oktáv magasságában.

A félhangot módosító, tetszõleges számú $b$, vagy \# közvetlenül a hang elõtt is állhat, ahogy az látható a negyedik sor második ütemében szereplõ $\#8F1$ hangnál. Az $R$-rel kezdõdõ elemek szüneteket jelölnek, melyek hosszát a mellettük álló szám jelöli (pl. az utolsó sor végén látható $R4$ egy $1/4$ hosszú szünetet takar).

Pontozott hangok itt is elõfordulhatnak, a pont helye a hangot jelölõ kód utolsó pozíciója, szerepe pedig a hang hosszának másfélszerezése (ilyen pl. az elsõ sor utolsó eleme: $4F2.$, melynek hossza így $1/4+1/8=3/8$).

%----------------------------------------------------------------------------
\section{Ritmusábrázolás}
%----------------------------------------------------------------------------

A fájlokból elsõ lépésben a korábban ismertetett TUBS ábrázolású vektorokat nyerjük ki. Ehhez meghatározunk egy $n$ egész számot, mely lehetõleg $2$ hatvány, majd azt mondjuk, hogy egy egységnyi ütemet ennyi üres dobozra osztjuk. Ezután beletesszük az elemeknek megfelelõ $1$-eseket a pozíciójukba. $16$-os felbontást feltételezve a \ref{list:kotta}-es kotta elsõ sora így ábrázolható: $1 0 1 0 1 0 1 0 | 1 0 1 0 1 0 1 0 | 1 0 1 0 0 0 0 0$, hiszen a nyolcadhangok ekkor kettõ helyet foglalnak el a listában, az utolsó pontozott negyed pedig hatot.

Az ugyanehhez a sorhoz tartozó intervallumok hosszait reprezentáló vektor a következõ: $[2, 2, 2, 2] [2, 2, 2, 2] [2, 6]$.

A szomszédos elemekhez tartozó arányok: $[1,00 1,00 1,00 1,00 1,00 1,00 1,00 1,00 3,00 0,33]$

A hangsúlyos elemek pozícióit tartalmazó vektor: $[1, 3, 5, 7, 9, 11, 13, 15, 17, 19]$

A kronotonikus lánc pedig: $[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 6, 6, 6, 6, 6, 6]$, melyet a \ref{fig:fig16} ábrán láthatunk grafikusan ábrázolva.

\begin{figure}[!hb]
\centering
	\begin{tikzpicture}
	\begin{axis}[ymin=0,ymax=6.2,enlargelimits=false]
	\addplot
	[const plot,blue, thick]
	coordinates
	{(0,    2) (12,    6) (16,    6)};
	\fill [blue,fill=blue!20] (axis cs:0,0) rectangle (axis cs:12,2);
	\fill [blue,fill=blue!20] (axis cs:12,0) rectangle (axis cs:16,6);
	\end{axis}
	\end{tikzpicture}
\caption{A példa fájl kronotonikus lánca}
\label{fig:fig16}
\end{figure}

%----------------------------------------------------------------------------
\section{A komparátorok}
%----------------------------------------------------------------------------

A ritmusok reprezentációinak elkészítése után a következõ lépés az összehasonlításért felelõs osztályok megírása volt. Az objektum-orientáltság szellemében ezek egy közös, \texttt{Comparer} nevû absztrakt osztály gyermekei, mely az összehasonlításért felelõs metóduson kívül minden más segédeljárást tartalmaz (ilyen pl. a számított távolságmátrix formázott kiírása, fájlba mentése, stb.).

%----------------------------------------------------------------------------
\section{Klaszterezések}
%----------------------------------------------------------------------------

Rendelkezésre állnak a hierarchikus klaszterezés alapvetõ implementációi (single, complete és average linkage), melyek egyköztes õsbõl \texttt{LinkageClassifier} származva szintén csak abban az egy metódusban térnek el, hogy hogyan határozzák meg a következõ összevonandó klasztereket.

%----------------------------------------------------------------------------
\section{Futtató felület}
%----------------------------------------------------------------------------